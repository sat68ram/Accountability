CREATE DATABASE IF NOT EXISTS CEO_ANALYTICS;
CREATE SCHEMA IF NOT EXISTS CEO_ANALYTICS.DASHBOARD;

CREATE OR REPLACE TABLE CEO_ANALYTICS.DASHBOARD.DIM_DATE (
  DATE_KEY        NUMBER(8,0)     NOT NULL COMMENT 'YYYYMMDD',
  DATE            DATE            NOT NULL,
  WEEK            NUMBER(2,0),
  MONTH           STRING          COMMENT 'YYYY-MM',
  QUARTER         STRING          COMMENT 'YYYY-Q',
  YEAR            NUMBER(4,0),
  IS_MONTH_END    BOOLEAN,
  IS_QUARTER_END  BOOLEAN,
  IS_YEAR_END     BOOLEAN,
  LOAD_TS         TIMESTAMP_NTZ   DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TABLE CEO_ANALYTICS.DASHBOARD.DIM_ORG_UNIT (
  ORG_UNIT_ID         STRING      NOT NULL,
  ORG_UNIT_NAME       STRING,
  ORG_LEVEL           STRING      COMMENT 'COMPANY | BU | FUNCTION',
  PARENT_ORG_UNIT_ID  STRING,
  IS_ACTIVE           BOOLEAN     DEFAULT TRUE,
  LOAD_TS             TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TABLE CEO_ANALYTICS.DASHBOARD.DIM_GEOGRAPHY (
  GEO_ID        STRING      NOT NULL,
  REGION        STRING,
  COUNTRY       STRING,
  MARKET        STRING,
  LOAD_TS       TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TABLE CEO_ANALYTICS.DASHBOARD.DIM_PRODUCT (
  PRODUCT_ID     STRING      NOT NULL,
  PRODUCT_NAME   STRING,
  PRODUCT_LINE   STRING,
  CATEGORY       STRING,
  LOAD_TS        TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP
);


CREATE OR REPLACE TABLE CEO_ANALYTICS.DASHBOARD.DIM_CUSTOMER (
  CUSTOMER_ID        STRING      NOT NULL,
  CUSTOMER_NAME      STRING,
  CUSTOMER_SEGMENT   STRING,
  INDUSTRY           STRING,
  LOAD_TS            TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TABLE CEO_ANALYTICS.DASHBOARD.DIM_SCENARIO (
  SCENARIO_ID     STRING      NOT NULL COMMENT 'ACTUAL | PLAN | FORECAST',
  SCENARIO_NAME   STRING,
  LOAD_TS         TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TABLE CEO_ANALYTICS.DASHBOARD.DIM_METRIC (
  METRIC_ID           STRING      NOT NULL,
  METRIC_NAME         STRING,
  METRIC_CATEGORY     STRING      COMMENT 'OUTCOME | CUSTOMER | EXECUTION | PEOPLE | RISK',
  METRIC_UNIT         STRING      COMMENT '%, $, DAYS, RATIO',
  IS_NORTH_STAR       BOOLEAN     DEFAULT FALSE,
  OWNER_ROLE          STRING      COMMENT 'CEO | CFO | COO | CHRO',
  FORMULA_DESC        STRING,
  TARGET_DIRECTION    STRING      COMMENT 'HIGHER_IS_BETTER | LOWER_IS_BETTER',
  LOAD_TS             TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TABLE CEO_ANALYTICS.DASHBOARD.FACT_CEO_METRICS (
  DATE_KEY        NUMBER(8,0)     NOT NULL,
  METRIC_ID       STRING          NOT NULL,
  ORG_UNIT_ID     STRING,
  GEO_ID          STRING,
  PRODUCT_ID      STRING,
  CUSTOMER_ID     STRING,
  SCENARIO_ID     STRING,

  METRIC_VALUE    NUMBER(18,4),

  TARGET_VALUE    NUMBER(18,4),
  STATUS          STRING          COMMENT 'GREEN | AMBER | RED',
  TREND           STRING          COMMENT 'UP | DOWN | FLAT',

  CREATED_TS      TIMESTAMP_NTZ   DEFAULT CURRENT_TIMESTAMP
);


CREATE OR REPLACE TABLE CEO_ANALYTICS.DASHBOARD.FACT_ENTERPRISE_RISK (
  DATE_KEY            NUMBER(8,0) NOT NULL,
  RISK_ID             STRING      NOT NULL,
  RISK_CATEGORY       STRING      COMMENT 'FINANCIAL | OPERATIONAL | CYBER | REGULATORY',
  SEVERITY            NUMBER(2,0) COMMENT '1-5',
  PROBABILITY         NUMBER(2,0) COMMENT '1-5',
  RISK_SCORE          NUMBER(4,0),
  MITIGATION_STATUS   STRING,
  LOAD_TS             TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP
);


CREATE OR REPLACE TABLE CEO_ANALYTICS.DASHBOARD.FACT_STRATEGIC_INITIATIVES (
  INITIATIVE_ID       STRING      NOT NULL,
  INITIATIVE_NAME     STRING,
  OWNER               STRING,
  START_DATE_KEY      NUMBER(8,0),
  END_DATE_KEY        NUMBER(8,0),
  HEALTH_STATUS       STRING      COMMENT 'GREEN | AMBER | RED',
  EXPECTED_IMPACT     STRING,
  LOAD_TS             TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP
);

ALTER TABLE CEO_ANALYTICS.DASHBOARD.FACT_CEO_METRICS
CLUSTER BY (DATE_KEY, METRIC_ID);

